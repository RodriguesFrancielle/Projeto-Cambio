<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    *{
      margin: 1px;
      padding: 3px;
    }
              body {
            background-color: aliceblue;
            justify-content: center;
            align-content: center;
            align-items: center;
            text-align: center;
            min-height: 100vh;
            display: flex;
            font-family: 'Roboto Condensed', sans-serif;
            font-weight: 70;
            

          }

          label {
            font-size: 20px;
          }

          legend h1 {
            font-weight: 700;
          }


          fieldset {
            margin: 10px;
            border-radius: 6px;
            
          }

          .idButtonCotacao {

              border: 2px none;
              font: inherit;
              line-height: 1;
              margin: 0.5em;
              padding: 1em 2em;
              border-radius: 8px;
              background-color: #fae881;
              transition: 0.25s;
              border-color: aliceblue;
              cursor: pointer;
              }

              .idButtonCotacao:hover {
              background-color: #f7d957;
            }
          

  </style>
    </head>
      <body>
        <fieldset>
          <legend> <h1>Casa de cambio</h1></legend>
        <form action="">
            <div>
                <div> 
                  <!-----------Select da Primeira Moeda-->
                    <label for="idMoeda">Selecione a Moeda de Entrada:</label>
                    <div>
                    <select id="idMoeda">
                      <option value="EUR">EURO</option>
                      <option value="AUD">Dólar australiano</option>
                      <option value="CAD">Dólar canadense</option>
                      <option value="CHF">Franco suíço</option>
                      <option value="DKK">Coroa dinamarquesa</option>
                      <option value="GBP">Libra Esterlina</option>
                      <option value="JPY">Iene</option>
                      <option value="NOK">Coroa norueguesa</option>
                      <option value="SEK">Coroa sueca</option>
                      <option value="USD">Dólar dos Estados Unidos</option>
                  </select>
                </div>
                </div> 
              
                <div>
                  <!-----------Entrada da Data-->
                  <label for="idData">Data: </label>
                  <div>
                  <input type="text" id="idData">
                  <p> EX: Mes-Data-Ano</p>
                </div>
                </div>

                <!-----------Select da Segunda Moeda-->
                <div> 
                  <label for="idMoeda2">Selecione a Moeda de Saída:</label>
                  <div>
                  <select id="idMoeda2">
                    <option value="EUR">EURO</option>
                    <option value="AUD">Dólar australiano</option>
                    <option value="CAD">Dólar canadense</option>
                    <option value="CHF">Franco suíço</option>
                    <option value="DKK">Coroa dinamarquesa</option>
                    <option value="GBP">Libra Esterlina</option>
                    <option value="JPY">Iene</option>
                    <option value="NOK">Coroa norueguesa</option>
                    <option value="SEK">Coroa sueca</option>
                    <option value="USD">Dólar dos Estados Unidos</option>
                </select>
              </div>
              </div> 

                  <!-----------Valor para conversão-->
              <div>
                <label for="idValor">Digite o Valor da Conversão:</label>
                <div>
                <input type="number" id="idValor">
              </div>
            </div>

                  <!-----------Button-->
              <div>
                <input class="idButtonCotacao" type="button" value="Buscar Cotação" id="idBtCotacao">
              </div>

              <!-----------Output - saída do resultado -->
              <div>
                <output id="idOut"></output>
              </div>
          </div>
        </form>
      </fieldset>

              <script>
                //Declaração das variaveis globais
                  var btCotacao = document.getElementById("idBtCotacao")
                  var moeda
                  var moeda2
                  var dataCotacao
                  var valorConversao
                  var buscarInfo
                  var buscarInfo2
                  var ObjBuscarInfo
                  var ObjBuscarInfo2
                  var resultado
                  var out = document.getElementById("idOut")

                // entrada dos dados e trazendo obj da função atravez do await
                  btCotacao.onclick = async function () {
                     moeda = document.getElementById("idMoeda").value
                     moeda2 = document.getElementById("idMoeda2").value
                     dataCotacao = document.getElementById("idData").value
                     valorConversao = Number(document.getElementById("idValor").value)

                      ObjBuscarInfo = await buscarInfo(moeda, dataCotacao)
                      ObjBuscarInfo2 = await buscarInfo2(moeda2, dataCotacao)

                      out.value = calculo(valorConversao)

                    }

                    //utilizando await fetch e return json p/  pegar a primeira moeda
                        async function buscarInfo(moeda, dataCotacao) {
                          console.log(moeda);
                          console.log(dataCotacao);

                            let resultado1 = await fetch("https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoMoedaDia(moeda=@moeda,dataCotacao=@dataCotacao)?@moeda='" +moeda+ "'&@dataCotacao='" +dataCotacao+ "'&$top=100&$format=json&$select=paridadeCompra,paridadeVenda,cotacaoCompra,cotacaoVenda,dataHoraCotacao,tipoBoletim")    
                            return resultado1.json()          
                        }

                          //utilizando await fetch e return json p/  pegar a segunda moeda
                        async function buscarInfo2(moeda2, dataCotacao) {
                          console.log(moeda2);
                          console.log(dataCotacao);
                          let resultado2 = await fetch("https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoMoedaDia(moeda=@moeda,dataCotacao=@dataCotacao)?@moeda='"+moeda2+"'&@dataCotacao='"+dataCotacao+"'&$top=100&$format=json&$select=paridadeCompra,paridadeVenda,cotacaoCompra,cotacaoVenda,dataHoraCotacao,tipoBoletim")
                            return resultado2.json()
                        }


                      function calculo(valorConversao){
                        //trazendo os obj p/ realizar o calculo da conversão entre as duas moedas.
                        let buscarInfo = ObjBuscarInfo.value[ObjBuscarInfo.value.length - 1].cotacaoCompra
                        let buscarInfo2 =  ObjBuscarInfo2.value[ObjBuscarInfo2.value.length - 1].cotacaoCompra
                        console.log(buscarInfo);
                        console.log(buscarInfo2);

                        
                        // verificar se as moedas são identicas e informar processo impossível, caso contrario realizar o calculo
                        if (moeda == moeda2) {
                          resultado = "Resultado: Processo impossível, Moedas Selecionadas são idênticas"
                        } else {
                          conversao = Number((buscarInfo /buscarInfo2) * valorConversao)
                          resultado = "Resultado: " + conversao
                        }
                        return resultado
                        
                      }

            </script>
      </body>
</html>